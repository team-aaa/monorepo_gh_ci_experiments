name: monorepo-jobs-ci

on:
  push:
    branches:
      - custom-check-action

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        jobs: [test-1, test-2, test-3]

    steps:
    - uses: actions/checkout@v2
    - name: Bundle
      working-directory: ${{ github.workflow }}
      run: |
        gem install bundler
        bundle config https://rubygems.pkg.github.com/forward3d ${{ secrets.GITHUB_PACKAGES_TOKEN }}
        bundle install --jobs 4 --retry 3
    - name: Get changed jobs
      id: changed_jobs_check
      uses: ./.github/actions/check
    - name: RSpec
      run: bundle exec rspec
      if: [[ " ${steps.changed_jobs_check.outputs.changed_jobs[@]} " =~ " ${github.workspace} " ]] 
      with:
        workspace: ${{ matrix.jobs }}
